<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/jquery-1.10.2.js"></script>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/underscore.js"></script>
    <script src="http://the5fireblog.b0.upaiyun.com/staticfile/backbone.js"></script>
</head>
<body>

</body>
<script>
    (function ($) {
        Backbone.sync = function(method, model, success, error){
            success();
        }
        var Item=Backbone.Model.extend({
            defaults:{part1:"hello",part2:"world"}
        })
        var List=Backbone.Collection.extend({
           model:Item
        })

        var ItemView=Backbone.View.extend({
            tagName:"li",
            events: {
                'click span.swap':  'swap',
                'click span.delete': 'remove'
            },
            initialize:function () {
                _.bindAll(this,"render",'unrender', 'swap', 'remove')
                this.model.bind('change', this.render);
                this.model.bind('remove', this.unrender);
            },
            render:function () {
                //$(this.el).html("<span>"+this.model.get("part1")+" "+this.model.get("part2")+"</span>");
                $(this.el).html('<span style="color:black;">'+this.model.get('part1')+' '+this.model.get('part2')+'</span> &nbsp; &nbsp; <span class="swap" style="font-family:sans-serif; color:blue; cursor:pointer;">[swap]</span> <span class="delete" style="cursor:pointer; color:red; font-family:sans-serif;">[delete]</span>');
                return this; // for chainable calls, like .render().el
            },
            unrender: function(){
                $(this.el).remove();
            },
            swap: function(){
                var swapped = {
                    part1: this.model.get('part2'),
                    part2: this.model.get('part1')
                };
                this.model.set(swapped);
            },
            remove: function(){
                this.model.destroy();
            }
        })
        var ListView=Backbone.View.extend({
            el:$('body'), // attaches `this.el` to an existing element.
            events: {
                "click button#add":'addItem'
            },
            initialize:function () {
                _.bindAll(this,'render','addItem','appendItem'); // remember: every function that uses 'this' as the current object should be in here
                this.collection=new List();
                this.collection.bind('add', this.appendItem); // collection event binder

                this.counter=0;
                this.render();
            },
            render:function () {
                var self=this;
               // $(this.el).append("<ul> <li>hello world</li> </ul>")
                $(this.el).append("<button id='add'>Add list item</button>");
                $(this.el).append("<ul></ul>");

                _(this.collection.models).each(function (item) {
                    self.appendItem(item)
                })
            },
            addItem:function () {
                this.counter++;
               // $('ul').append("<li>hello world"+this.counter+"</li>")好像这样也可以
               // $('ul',this.el).append("<li>hello world"+this.counter+"</li>")
                var item=new Item();
                item.set({part2:item.get("part2")+ this.counter});
                this.collection.add(item)
            },
            appendItem: function(item){
                //$('ul', this.el).append("<li>"+item.get('part1')+" "+item.get('part2')+"</li>");
                var itemView=new ItemView({model:item});
                $('ul', this.el).append(itemView.render().el);
            }
        })
        var listView=new ListView();
    })(jQuery)
</script>
</html>